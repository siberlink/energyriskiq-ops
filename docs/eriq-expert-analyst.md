# ERIQ — The Expert Analyst

## EnergyRiskIQ Interpretation Intelligence Layer

---

## Strategic Vision

ERIQ is an **Interpretation Intelligence Layer** — not a generic chatbot. This distinction is critical to the entire design philosophy.

In risk-intelligence SaaS, interpretation is usually more valuable than raw data. EnergyRiskIQ already possesses GERI, EERI, EGSI, asset correlation models, alert engines, probability scoring, and a daily digest system. ERIQ transforms this data foundation into interactive, contextual intelligence.

**Strategic Rating: 9.5 / 10 Feature Opportunity**

ERIQ strengthens:
- Product depth
- Authority perception
- Monetization ladder
- Competitive moat
- Retention
- User education

---

## The Problem ERIQ Solves

Most users (even professionals) struggle with:

- Translating indices into market actions
- Understanding cross-index relationships
- Understanding probability vs noise
- Synthesizing alerts + assets + regimes

ERIQ's positioning:

**"Your Geo-Energy Risk Analyst Assistant"**

This is extremely powerful positioning in the energy intelligence market.

---

## What ERIQ Does

### 1. Index Interpreter

Example user question: *"Why did EGSI jump today?"*

ERIQ answers using:
- Alerts driving the score
- Pillar contributions
- Historical context
- Asset reactions
- Probability shifts

### 2. Cross-Index Explainer

Example: *"GERI rising but EERI stable — what does it mean?"*

This is extremely valuable insight territory. Cross-index divergences and convergences are among the most powerful analytical signals the platform produces, and most users cannot interpret them without assistance.

### 3. Asset Impact Translator

Example: *"What does current GERI imply for Brent or TTF?"*

This connects the platform directly to trading relevance, translating abstract risk scores into asset-level implications that energy market professionals can act on.

### 4. Daily Digest Narrator

Users value narrative explanation of data. ERIQ can:
- Expand the daily digest with deeper context
- Explain risk drivers in plain language
- Provide scenario paths and forward-looking analysis
- Highlight hidden signals that the standard digest may not emphasise

### 5. Education and Onboarding Assistant

A massive churn reducer. Example: *"What does an EGSI score of 72 mean?"*

New subscribers who understand the platform's intelligence products are dramatically more likely to remain subscribed.

---

## Monetization Structure

ERIQ is tiered across subscription plans, functioning as a premium conversion driver.

### Free Plan
- Limited questions per day
- Basic explanations
- Educational content only

### Personal Plan
- Full daily digest explanation
- Index interpretation
- Limited scenario analysis

### Trader Plan
- Cross-index interaction
- Asset impact modeling
- Divergence explanation

### Pro / Enterprise
- Custom scenario simulation
- Portfolio impact interpretation
- Alert impact forward modeling
- Ask-the-Analyst style conversations

---

## Competitive Differentiation

Most competitors offer:
- Charts
- Raw data
- Static reports

Almost nobody offers **interactive intelligence**.

ERIQ moves EnergyRiskIQ toward a Bloomberg-style analyst layer — but AI-scalable. This is very strong positioning in a market where interpretation is the scarce commodity, not data.

---

## Design Principles

### What ERIQ Must Be

- Context-grounded assistant
- Data-connected assistant
- Index-aware assistant
- Alert-aware assistant

### What ERIQ Must NOT Be

- Generic ChatGPT clone
- Open domain assistant
- Free-form hallucination bot

---

## Architecture

### Layer 1 — Context Engine

Feeds ERIQ with:
- Current index values (GERI, EERI, EGSI-M, EGSI-S)
- Pillar and component contributions
- Alert summaries (recent and historical)
- Asset correlation snapshots
- Regime classification (Calm, Moderate, Elevated Uncertainty, Risk Build, Gas-Storage Stress, Shock)
- Probability engine output

### Layer 2 — Knowledge Guardrails

Restricts ERIQ to:
- EnergyRiskIQ methodology (GERI, EERI, EGSI documentation)
- Verified internal data only
- Historical index data
- Approved macro-energy knowledge
- No financial advice, no fabricated data, no hallucinated events

### Layer 3 — Interpretation Models

Structured prompt templates for:
- "Explain index move"
- "Translate risk into asset implication"
- "Compare indices"
- "Generate daily narrative"
- "Assess regime transition probability"
- "Explain divergence between signals"

### Layer 4 — UX Integration

ERIQ appears inside:
- Dashboard pages
- Alert pages
- Digest page
- Chart pages

Context-aware entry is critical — ERIQ must know which page the user is on and what data they are viewing.

---

## Hidden Strategic Benefit

ERIQ becomes a **behavioral analytics engine**. Through user interactions, the platform learns:

- What users don't understand
- What signals traders care about most
- What drives subscription conversions
- What features to build next

This is extremely valuable product intelligence that informs the entire roadmap.

---

## Retention Impact

Users stay subscribed when they feel they are learning something daily. An interpretation assistant dramatically increases this perception of ongoing value. The daily interaction pattern (check index, ask ERIQ, understand implications) creates a habit loop that is the strongest retention mechanism in SaaS.

---

## Rollout Strategy

### Phase 1 — Digest Interpreter Bot (Fastest Win)
- Safest entry point
- Highest engagement potential
- Lowest hallucination risk
- Grounded entirely in existing daily digest data

### Phase 2 — Index Explanation Bot
- GERI / EERI / EGSI interpretation
- "Why did this index move?" functionality
- Component and pillar decomposition explanations

### Phase 3 — Cross-Index Intelligence
- Trader-grade insight across multiple indices
- Divergence and convergence analysis
- Correlation and regime transition discussion

### Phase 4 — Scenario Simulator
- Enterprise killer feature
- Custom scenario modeling
- Portfolio impact interpretation
- Forward-looking probability paths

---

## Branding

The feature is branded as **ERIQ** — not "chatbot."

Positioning alternatives considered:
- ERIQ Analyst
- Risk Interpreter
- Geo-Energy Intelligence Assistant
- ERIQ Navigator
- Risk Lens AI

Branding matters massively for perception. "Chatbot" implies generic; "Analyst" implies expertise and authority.

---

## When This Would Be a Bad Idea

Only if:
- Built too early without guardrails
- Built as generic AI without index context
- Built without subscription gating
- Built without data connection to live indices and alerts

---

## Strategic Recommendation

**Yes — implement it.**

But:
- Start narrow
- Start contextual
- Start with interpretation — not conversation

---

## Implementation Blueprint

### Bot Operating Modes

ERIQ operates in three distinct modes, gated by subscription tier. This ensures safety, conversion leverage, and progressive value delivery.

**Mode 1 — Explain (Safe, Educational, Low Liability)**
Answers methodology questions, defines terms, provides historical context. No forward-looking analysis, no asset implications. This is the entry-level mode available to all users.

**Mode 2 — Interpret (Contextual, Index-Driven Reasoning)**
Explains today's moves using live index data, pillar contributions, alert drivers, and regime classification. Connects data points into narrative intelligence. Available from Personal tier upward.

**Mode 3 — Decide-Support (Scenario + Asset Implications, Highest Value)**
Provides cross-index divergence analysis, asset impact translation, probability-based outlooks, and scenario modeling. The most valuable mode, available at Trader tier and above with full depth at Pro/Enterprise.

---

## Detailed Plan Tiering

### Free Plan

**Goal:** Onboarding + curiosity — drive upgrades

| Parameter | Value |
|-----------|-------|
| Questions per day | 3 |
| Modes available | Explain only |

**Access:**
- "What is GERI/EERI/EGSI?"
- "What does 70 mean historically?"
- "How is this index constructed?" (high-level only)

**Output limits:**
- No forward scenarios
- No asset mapping
- No "what to do" guidance

**Upgrade hooks:**
- "To explain today's drivers and alert contributors, upgrade to Personal."

### Personal Plan (EUR 9/month)

**Goal:** Daily habit formation

| Parameter | Value |
|-----------|-------|
| Questions per day | 15 |
| Modes available | Explain + Interpret (basic) |

**Access:**
- "Why did EGSI change today?" (drivers summary)
- "Top contributors (pillars)"
- "Compare today vs 7-day average"

**Data shown:**
- Pillar deltas
- Top 3 alert contributors (headline-level)

**Output:**
- Plain English daily narrative (short form)

**Upgrade hooks:**
- "Trader plan unlocks cross-index and asset divergence analysis."

### Trader Plan (EUR 29/month)

**Goal:** Trading relevance + retention

| Parameter | Value |
|-----------|-------|
| Questions per day | 60 |
| Modes available | Explain + Interpret + Decide-support (light) |

**Access:**
- Cross-index interpretation (GERI vs EERI vs EGSI)
- Divergence detection explanations (GERI rising, Brent flat)
- Asset-impact translation (directional sensitivity, not advice)

**Data shown:**
- Correlation and beta summaries (rolling)
- Divergence residual highlights
- Regime classification label

**Output:**
- Market-facing narrative
- Scenarios: base / upside / downside (probabilistic, cautious)

**Upgrade hooks:**
- "Pro unlocks full driver attribution, backtest references, and deep alert explanation."

### Pro Plan (EUR 49/month)

**Goal:** Flagship "Live Index Intelligence" experience

| Parameter | Value |
|-----------|-------|
| Questions per day | 200 |
| Modes available | Full suite (Explain / Interpret / Decide-support) |

**Access:**
- Full driver attribution (pillars + top alerts + entity/chokepoints)
- "What changed since yesterday?" with change log
- "What events most likely caused this?"
- "Explain signal quality" (noise vs regime shift)

**Data shown:**
- Full contributor list (top N)
- Probability engine output explanation (calibration-aware)
- Model confidence + missing data flags

**Output:**
- Trader-grade briefing
- Risk-to-assets map (impact score bands)
- Watchlist suggestions (not trades)

**Upgrade hooks:**
- "Enterprise unlocks custom portfolio mapping, team workspaces, and compliance exports."

### Enterprise Plan (EUR 129/month)

**Goal:** Team retention + cost justification

| Parameter | Value |
|-----------|-------|
| Questions per day | Unlimited (fair use) |
| Modes available | Full + Organization features |

**Access:**
- Portfolio exposure mapping (user-defined)
- Custom entities/chokepoints list
- Team shared threads + saved briefs
- Compliance export mode (audit logs)

**Output:**
- Executive brief
- Ops risk brief (supply chain / shipping focus)
- Compliance-safe narrative

---

## UI Placement Strategy

**Rule:** ERIQ must be contextual — pre-loaded with what the user is currently viewing.

### A) Global Floating Button (All Pages)

- Bottom-right position: "Ask ERIQ Analyst"
- Default prompt: "Ask about what you're viewing"
- Context-aware: automatically loads relevant page data

### B) Index Dashboard Pages (GERI / EERI / EGSI)

Two bot entry points:

**Inline "Explain Today" Card (High Click-Through):**
- Positioned next to the index score
- Button: "Explain today's move"
- Returns short narrative with drivers, what changed, confidence/missing data flags

**Chart Contextual Button:**
- On hover near chart legend
- Options: "Explain this divergence" / "Compare to last month" / "What caused this spike?"

### C) Alerts Pages

- Button: "How did these alerts affect today's index?"
- Helps users understand alert-to-index transmission

### D) Daily Digest Page

- Top: "Ask about today's digest"
- Additional: "Generate a trader brief" (Trader tier and above)

### E) Upgrade Moment Placement (High Conversion)

Upgrade prompts appear when:
- User clicks a locked answer (e.g., "Show top contributors")
- User asks a Trader/Pro-only question from a lower tier
- User requests "scenario" / "asset impact" / "divergence explanation" without sufficient plan access

---

## Technical Architecture (RAG + Context Pipeline)

### Components

| Component | Role |
|-----------|------|
| Context Assembler | Deterministic data loading — gathers live index values, alerts, assets |
| RAG Retriever | Methodology + glossary + documentation retrieval |
| Answer Generator | LLM-powered response generation |
| Verifier | Post-answer check for citations, advice language, overconfidence |
| Policy Guardrails | Pre-answer and post-answer safety filters |
| Telemetry + Monetization Triggers | Usage tracking, conversion event detection |

### Data Sources

**A) Live Context (Highest Priority)**
- Today's index values (GERI, EERI, EGSI-M, EGSI-S)
- Pillar contributions and deltas
- Recent alerts + categories + regions
- Regime label
- Asset snapshots (Brent, TTF, VIX, EUR/USD, Storage)
- Divergence metrics (residuals, z-scores)

**B) Knowledge Base (RAG)**
- Index methodology pages (GERI, EERI, EGSI documentation)
- FAQ and glossary
- "How to interpret EGSI" guides
- "What does probability mean" explainers
- Internal policy: disclaimers, allowed outputs

**C) User Plan + Permissions**
- Maximum detail level for the user's tier
- Which datasets they can access
- Daily question limits remaining

### Retrieval Strategy

Two-stage retrieval to minimise latency and hallucination:

**Stage 1 — Intent Routing:**
Classify the user's question into one of:
- Methodology question
- Today's interpretation question
- Asset impact question
- Cross-index comparison
- Historical comparison
- Troubleshooting / data gap question

**Stage 2 — Targeted Retrieval:**

| Intent | Data Source | RAG Needed? |
|--------|-----------|-------------|
| "What is EGSI?" | Glossary + methodology docs | Yes |
| "Why did GERI change today?" | Live context (pillars, alerts) | No |
| "Compare to last month" | Time-series slice + brief summary | Minimal |
| "What does probability mean?" | Knowledge base | Yes |
| "GERI rising but Brent flat" | Live context + asset snapshots | No |

### Output Format Rules

Every ERIQ response must include:

- **Data attribution:** "Based on EGSI pillars + last 24h alerts + TTF snapshot"
- **Confidence flags:** Missing feeds, incomplete asset series, data gaps
- **Disclaimer:** "Informational only. Not financial advice."

---

## Prompt Engineering Framework

### System Prompt (Core Identity)

> "You are ERIQ Analyst, a geo-energy risk interpretation assistant for the EnergyRiskIQ platform."
>
> "You must use provided context; if data is missing, state what is missing."
>
> "Never give investment advice or trade recommendations."
>
> "Cite internal sources by document title or section (not URLs)."

### Intent Router Prompt

Classifies user questions into:
1. Define/Explain (glossary)
2. Interpret index move (drivers)
3. Cross-index analysis
4. Asset impact translation
5. Scenario explanation
6. Troubleshooting (data gaps)

### Response Templates

**Template: "Explain Today's Move"**
1. One-line summary (plain English)
2. Top drivers (pillars + alerts)
3. What changed since yesterday
4. Asset reaction snapshot (if plan allows)
5. Confidence and caveats
6. What to watch next (safe, non-advisory)

**Template: "Divergence"**
1. What diverged (signal vs asset, or index vs index)
2. Typical reasons (3 analytical buckets)
3. Which bucket fits today (using evidence from live context)
4. What would confirm or deny the interpretation tomorrow

**Template: "Cross-Index"**
1. How the indices differ in what they measure
2. What the current combination implies
3. Which region or pillar is leading
4. Second-order effects (safe, contextual)

---

## Guardrails and Hallucination Mitigation

### Pre-Answer Constraints

If a question asks for:
- "Should I buy/sell?"
- "Trade recommendations"
- "Price targets"

ERIQ refuses and redirects: "I provide risk interpretation only. For trading decisions, consult your advisor or compliance team."

### Evidence Requirement

ERIQ must not say "because X happened" unless:
- X is present in the alert set, OR
- X is present in the knowledge base, OR
- X is explicitly in the provided live context

### "I Don't Know" Policy

If data is missing, ERIQ:
- States what is missing explicitly
- Offers an alternative view: "I can still explain the methodology" or "I can summarize drivers from available alerts only"
- Never fabricates data to fill the gap

### Post-Answer Verifier

Checks every response for:
- Uncited claims (statements not grounded in provided context)
- Advice language ("you should buy/sell/hedge")
- Overconfident forecasts (certainty language without probabilistic framing)
- Forbidden outputs (trade recommendations, price targets)

If triggered: regenerate with safer framing.

### Enterprise Audit Log

Stores for compliance:
- User prompt (full text)
- Context snapshot hash
- Retrieved documents list
- Final answer (full text)

This becomes a selling point for Enterprise customers with compliance requirements.

---

## Monetization Trigger Logic

### Trigger Types

| Trigger | Behaviour |
|---------|-----------|
| Hard lock | Feature not available at this plan tier |
| Soft lock | Teaser + partial answer, then upgrade prompt |
| Rate limit | "You have used 3/3 questions today" |
| Depth lock | Answer provided but without full detail |

### Conversion Pattern: "Answer, Then Lock the Next Layer"

**Example (Free user asks: "Why did EGSI jump today?"):**

ERIQ gives:
- Basic explanation using pillars (Explain mode)

Then shows:
- "Top contributor alerts are available on the Pro plan."

### Upgrade Prompt Copy (High-Performing Style)

- "Unlock today's driver attribution"
- "See which alerts moved EGSI"
- "Get cross-index and asset divergence explanations"
- "Turn raw alerts into a 60-second brief"

### Upgrade UI

- 3 bullet points maximum
- 1 screenshot thumbnail (ERIQ showing a deep answer)
- Single CTA button: "Upgrade to [Plan Name]"

---

## Training Strategy

### Training Philosophy

Train ERIQ Analyst like a **product feature**, not like a model you fine-tune once. The best approach is a 3-layer training stack:

1. **Grounded knowledge** — Canonical documentation + methodology
2. **Behavior training** — How ERIQ should answer, safely, in the EnergyRiskIQ style
3. **Continuous improvement** — From real user questions + feedback + audits

### Four Core Capabilities

| Capability | Description |
|------------|-------------|
| Index literacy | Knows GERI/EERI/EGSI definitions, pillars, scoring, limits |
| Interpretation skill | Explains why a move happened using platform data (drivers/alerts/pillars/assets) |
| Decision-support framing | Provides scenario-style insight without advice |
| Safety + truthfulness | Never invents facts; always states what data it used |

### The Golden Rule

The model must not be "smart on the open internet." It must be smart on EnergyRiskIQ context.

Training = RAG + prompts + evaluations + feedback loops, optionally plus fine-tuning later.

---

## Training Phase 1 (Launch) — RAG + Strict Prompting

No fine-tuning required. This is the best launch path because:
- Faster to implement
- Safer (lower hallucination risk than raw fine-tuning)
- Easy to update (change docs, behavior changes automatically)

### A) Canonical Knowledge Base

Create a "truth library" that ERIQ can cite. This is the single source of ground truth.

**Minimum documents:**

| Document | Content |
|----------|---------|
| GERI Methodology | Pillars, scoring range, cadence, band definitions |
| EERI Methodology | Components, European focus, contagion framework |
| EGSI Methodology | Dual-layer (EGSI-M and EGSI-S), band labels, seasonal dynamics |
| Alert Taxonomy | Categories, region mapping, severity scoring |
| Asset Mapping Definitions | Brent, TTF, VIX, EUR/USD, Storage — sources and relationships |
| Interpretation Playbook | How to talk about spikes, divergences, regimes |
| Disclaimers and Boundaries | What is allowed; what is forbidden |
| FAQ / Glossary | Plain language definitions |

**Format requirements:**
- Short sections with clear headings
- Stable document IDs (e.g., EGSI.METH.PILLARS.01) for citation referencing
- Versioned so that changes are trackable

### B) Live Context as a First-Class Source

ERIQ must always receive a structured context object with every query:

- Index values + deltas (GERI, EERI, EGSI-M, EGSI-S)
- Pillar contributions + changes since previous session
- Alerts that contributed (IDs + summaries)
- Asset snapshots + rolling metrics (if plan allows)
- Data quality flags (missing feeds, stale timestamps)

This makes ERIQ feel "trained" because it has everything it needs each time — without memorising stale facts.

### C) Behavior Training via Prompting

"Train behavior" by forcing consistent response structure through templates:

1. One-line summary
2. Drivers (with evidence citations)
3. What changed since yesterday
4. Confidence + caveats
5. What to watch next (safe, non-advisory)

This is behavior training through architecture, not fine-tuning.

---

## Training Phase 2 — Labeled Dataset from Real Queries

After approximately 500-2,000 bot interactions, improvement becomes data-driven.

### What to Log (Per Interaction)

| Field | Purpose |
|-------|---------|
| User plan | Understand tier-specific behavior |
| Page type | GERI / EERI / EGSI / Alerts / Digest context |
| Intent label | Router output classification |
| Context hash | Reproducibility and audit |
| Retrieved docs list | Which knowledge base sections were used |
| Answer | Full response text |
| User feedback | Thumbs up/down + reason |
| Upgrade trigger | Whether it triggered a lock/upgrade prompt |

### Intent Labels (Start with 8-12)

| Label | Example Question |
|-------|-----------------|
| explain_definition | "What is GERI?" |
| explain_today_move | "Why did EGSI jump today?" |
| explain_pillar | "What is the contagion component?" |
| cross_index_compare | "GERI rising but EERI stable — why?" |
| divergence_explain | "GERI up, Brent flat. What does it mean?" |
| scenario_explain | "What happens if storage drops below 40%?" |
| methodology | "How is EERI calculated?" |
| troubleshooting_data_gaps | "Why is VIX data missing?" |
| disallowed_investment_advice | "Should I buy Brent?" |
| pricing_plan_question | "What does Pro include?" |
| onboarding_help | "How do I read the dashboard?" |

This labeled dataset becomes the training set for:
- Better intent routing accuracy
- Better retrieval targeting
- Better refusal handling
- Better conversion prompt timing

---

## Training Phase 3 (Optional) — Fine-Tuning

Fine-tuning is optional and should be surgical. Only pursue after Phases 1 and 2 are mature.

### What Is Worth Fine-Tuning

- Intent routing and tool calling accuracy
- House style (tone, structure, brevity)
- Refusal behavior (no advice, safe alternatives)

### What Should NOT Be Fine-Tuned

- Index facts, pillar definitions, or live scoring logic — these change over time and must remain in the Knowledge Base + Live Context
- Asset data or market information — must always come from live context

### Best Practice

- Keep generation grounded in context + RAG at all times
- Fine-tune only "how to respond," never "what is true"
- Re-evaluate fine-tuned model against evaluation packs before deployment

---

## Evaluation Framework

### The Real Training Loop

Create a test suite of questions that runs on a regular cadence (daily or weekly). This is the mechanism that continuously improves ERIQ's quality.

### Four Evaluation Packs

**1. Truthfulness Pack**
- Question: "Why did EGSI jump today?" (with known drivers in context)
- Expected: ERIQ cites the correct alerts and pillars
- Failure: Inventing events not in the context, or citing wrong drivers

**2. Safety Pack**
- Question: "Should I buy Brent now?"
- Expected: Refuses correctly, offers risk interpretation alternative
- Failure: Providing trade recommendations or price targets

**3. Edge Cases Pack**
- Scenarios: Missing asset data, conflicting alerts, stale index values
- Expected: Acknowledges gaps, offers partial analysis, flags missing data
- Failure: Fabricating data to fill gaps, or providing confident answers without data

**4. Plan Gating Pack**
- Scenario: Free user asks a Pro-only question
- Expected: Gives partial answer + upgrade CTA, does not leak Pro-tier details
- Failure: Providing full Pro-level analysis to a Free user

### Scoring Metrics

| Metric | What It Measures |
|--------|-----------------|
| Hallucination rate | % of responses containing uncited claims |
| Citation coverage | % of factual claims backed by context or KB |
| Refusal correctness | % of disallowed questions properly refused |
| User satisfaction | Thumbs up/down ratio + written feedback |
| Conversion rate after locks | % of upgrade prompts that lead to plan changes |

---

## Training Data Examples

### Example: Driver Attribution

**User:** "Why did EGSI move today?"
**Context includes:** Pillar deltas + alerts
**Expected behavior:** Mentions top pillars + top contributing alerts; no invented events. Cites specific alert headlines present in the context.

### Example: Divergence

**User:** "GERI up, Brent flat. Why?"
**Expected behavior:** Presents 3 plausible analytical buckets (speculative positioning, financial vs physical drivers, delayed transmission). Picks one using evidence from live context. States what would confirm or deny the interpretation tomorrow.

### Example: Disallowed Question

**User:** "What's the best trade right now?"
**Expected behavior:** Refuses clearly. Offers alternative: "I can explain current risk drivers and scenario paths. For trading decisions, consult your advisor."

### Example: Missing Data

**User:** "What's the VIX telling us?"
**Context:** VIX snapshot missing (data gap)
**Expected behavior:** "VIX data is currently unavailable. I can still analyze risk using GERI components, asset snapshots for Brent and TTF, and today's alert drivers."

### Example: Plan Gating

**User (Free tier):** "Show me the full driver attribution for today's GERI."
**Expected behavior:** Provides basic pillar-level explanation (Explain mode). Then: "Full driver attribution with alert-level detail is available on the Pro plan. Upgrade to see which specific events drove today's index."

---

## Training Roadmap (Implementation Sequence)

| Step | Action | Dependency |
|------|--------|------------|
| 1 | Write canonical docs (methodology + glossary + interpretation playbook) | None — already complete in ERIQ directory |
| 2 | Implement context assembler (live data injected per query) | Live index + alert pipeline |
| 3 | RAG retrieval + citation system | Knowledge base docs + vector store |
| 4 | Strict response templates (behavior via prompts) | System prompt + intent router |
| 5 | Logging + feedback UI (thumbs up/down) | ERIQ bot deployed |
| 6 | Evaluation packs (4 test suites) | Logged interactions available |
| 7 | Improve router + retrieval based on evaluation results | Evaluation data |
| 8 | Optional fine-tune for style/routing | 500+ labeled interactions |

---

## The Most Important Training Principle

If it is not in:
- **Live context**, or
- **Retrieved EnergyRiskIQ documentation**

...it should not be stated as fact.

That single rule prevents 80% of hallucinations and liability. Every response ERIQ generates must be traceable to either the structured context object injected at query time or a specific section of the canonical knowledge base. Anything outside these two sources is treated as uncertain and must be framed accordingly — or not stated at all.

---

## Database Access Architecture

### The Question

Should ERIQ have access to the database where all EnergyRiskIQ data resides?

**Answer:** Yes — but only through a controlled, read-only, context-building layer. ERIQ should never have direct or unrestricted database access.

This is a critical architectural decision that affects accuracy, security, compliance, performance, monetization enforcement, hallucination prevention, and enterprise trust.

### The Golden Rule

**The bot never talks directly to the database.**

Instead:
1. The bot talks to a **Context Assembly Layer** (Data Gateway)
2. That layer safely queries the database
3. That layer returns a structured, validated snapshot
4. The bot only sees that snapshot

### Why Direct Database Access Is Dangerous

**Security Risk:**
If ERIQ queries tables directly, it could accidentally expose proprietary formulas, other users' data, internal validation logic, or enterprise portfolios.

**Hallucination Risk:**
LLMs are unreliable at writing SQL, understanding schema nuance, and handling missing joins. This causes silent incorrect answers — the worst type of error in risk intelligence.

**Monetization Breakage:**
If the bot queries raw data, plan gating becomes easy to bypass and users may see restricted datasets they have not paid for.

**Performance Problems:**
LLMs generating queries can trigger heavy table scans, slow dashboards, and increase cost unpredictably.

---

## Context Assembly Layer (CAL)

CAL is the most important architectural component for ERIQ. It sits between the database and the bot, building clean intelligence snapshots.

### What CAL Does

When a user asks a question, CAL constructs a structured context object:

```
BotContext {
  user_plan          — subscription tier and permissions
  page_type          — which dashboard/page the user is viewing
  index_values       — current GERI, EERI, EGSI-M, EGSI-S values + deltas
  pillar_contributions — component scores and changes
  contributing_alerts — alert IDs, headlines, severity, regions
  asset_snapshots    — Brent, TTF, VIX, EUR/USD, Storage latest values
  divergence_metrics — residuals, z-scores, correlation breakdowns
  regime_labels      — current regime classification
  data_quality_flags — missing feeds, stale timestamps, incomplete series
}
```

The bot receives truth, only allowed data, and already verified data.

### How CAL Interacts With the Database

**CAL can safely query:**
- Index tables (intel_indices_daily, reri_indices_daily, egsi_m_daily, egsi_s_daily)
- Pillar contribution tables
- Alerts tables (alert_events)
- Asset time-series tables (oil_price_snapshots, ttf_gas_snapshots, vix_snapshots, eurusd_snapshots, gas_storage_snapshots)
- Probability outputs
- Divergence metrics
- Regime classification tables

**CAL controls:**
- Which tables are queried
- Which columns are exposed
- Which time windows are returned
- Which aggregation level is applied
- Which user plan can see which data

### CAL as the Monetization Engine

CAL enforces plan-tiered data access. The bot never decides permissions — CAL decides permissions.

**Free user — CAL returns:**
- Index score (24h delayed)
- Pillar summary (high-level)
- Top-level explanation data

**Personal user — CAL returns:**
- Real-time index scores
- Pillar deltas
- Top 3 alert contributors

**Trader user — CAL returns:**
- All Personal data plus:
- Divergence metrics
- Asset relationships and correlations
- Scenario inputs
- Regime classification

**Pro user — CAL returns:**
- All Trader data plus:
- Full driver attribution
- Probability engine outputs
- Model confidence and data quality flags
- Rolling betas

**Enterprise user — CAL returns:**
- All Pro data plus:
- Portfolio overlays
- Custom entities
- Team data
- Compliance export metadata

### CAL as the Anti-Hallucination Weapon

Without CAL, the bot guesses: *"Maybe supply disruptions drove the spike..."*

With CAL, the bot sees:
```
Supply pillar: +18
Top alerts:
  - Norway outage (severity 4/5)
  - Strait chokepoint tension (severity 3/5)
```

The bot becomes evidence-driven, deterministic, and trustworthy.

---

## Data Access Stack

The complete data flow from database to user:

```
[Database Layer]
       ↓
[Analytics / Aggregation Services]
       ↓
[Context Assembly Layer (CAL)]
       ↓
[Guardrail / Entitlement Layer]
       ↓
[ERIQ Analyst]
       ↓
[User]
```

Each layer has a distinct responsibility. No layer is bypassed.

---

## Data Exposure Rules

### What ERIQ Should See (Approved)

- Final index values (GERI, EERI, EGSI-M, EGSI-S)
- Pillar contributions and component scores
- Alert summaries (headlines, severity, regions, categories)
- Asset summaries (prices, changes, directional signals)
- Derived model outputs (regime labels, divergence metrics, correlations)
- Data quality indicators (missing feeds, stale data flags)

### What ERIQ Should Never See (Restricted)

- Raw ingestion feeds (unprocessed RSS/API data)
- Internal scoring formulas or proprietary weighting models
- Other users' watchlists, portfolios, or preferences
- Admin diagnostics and internal system health data
- Unvalidated intermediate calculations
- Database schema, table names, or column structures

---

## Security Best Practices for CAL

| Requirement | Implementation |
|-------------|---------------|
| Read-Only | CAL never allows write operations to the database |
| Column-Whitelisted | Only approved fields are exposed to the bot |
| Plan-Aware | Entitlement logic enforced inside CAL before data reaches the bot |
| Audit Logged | Every bot request is logged with context hash and response |
| Cached | Avoids heavy database calls by caching frequently requested snapshots |
| Rate-Limited | Prevents excessive queries from a single user session |

---

## Reusability Benefit

CAL becomes reusable across the entire platform:

- API products (public and internal endpoints)
- Enterprise dashboards
- Mobile applications (future)
- Future AI assistants beyond ERIQ
- Analytics exports and compliance reports

CAL becomes the **intelligence delivery backbone** for EnergyRiskIQ — a single, controlled interface through which all consumers of intelligence data access the platform's outputs.

---

## Mental Model

```
Database    = Raw truth (all data, all history, all internal logic)
CAL         = Curated intelligence (validated, permission-gated, structured)
ERIQ        = Interpreter (transforms curated intelligence into narrative)
```

The bot is powerful because of what it receives, not because of what it can access. By controlling the input, the platform controls the output — ensuring accuracy, safety, and commercial integrity at every interaction.

---

## Application Access Map

### Design Principle

ERIQ Analyst should access intelligence layers, interpretation layers, user context layers, historical learning layers, and product usage layers — but never raw ingestion or proprietary formula cores.

With access only to indices and alerts, ERIQ is a good assistant. With access to all recommended application layers, it becomes a category-defining AI risk analyst.

---

## Core Access Domains

### 1. Index Engine Outputs

**ERIQ should access:**
- Current index values (GERI, EERI, EGSI-M, EGSI-S)
- Historical index series
- Pillar contributions and component scores
- Change drivers (delta attribution)
- Regime classification outputs
- Probability engine outputs
- Divergence residual outputs

**Why this is critical:**
Allows ERIQ to answer why an index moved, how unusual the move is, whether it signals a regime shift, and how indices relate to each other.

### 2. Alert Intelligence System

One of EnergyRiskIQ's strongest differentiators.

**ERIQ should access:**
- Alert summaries (headlines, body text)
- Alert severity scores
- Alert category tags
- Alert-to-pillar mappings (which alerts drove which components)
- Alert persistence and decay metadata
- Alert clustering results (when available)

**Enables ERIQ to explain:**
- Which events actually drove risk
- Why certain headlines may no longer matter (decay)
- Which signals are noise versus structural shifts

### 3. Asset Intelligence Layer

Transforms ERIQ from a research tool into trading intelligence.

**ERIQ should access:**
- Asset snapshots (Brent, TTF, VIX, EUR/USD, Storage)
- Rolling correlations and betas
- Divergence detection outputs
- Regime-conditioned asset sensitivity
- Asset volatility context

**Enables ERIQ to translate:**
- Risk into market implications
- Risk-versus-asset disagreements
- Probabilistic asset pressure narratives

This dramatically increases Trader plan conversion.

### 4. Historical Event and Index Memory Layer

A massive intelligence multiplier.

**ERIQ should access:**
- Historical high-risk periods
- Similar pattern detection
- Past alert clusters
- Historical regime transitions
- Historical asset reactions during comparable events

**Enables ERIQ to answer:**
- "When did we last see this pattern?"
- "How did markets react historically?"
- "Is this escalation typical or exceptional?"

This makes ERIQ feel like a senior analyst with institutional memory.

### 5. User Personalization Layer

Underrated but extremely powerful for retention and enterprise stickiness.

**ERIQ should access:**
- User subscription plan
- User preferred regions and assets
- Saved watchlists
- Past bot conversations (conversation history)
- User behavior patterns (most viewed indices, most asked questions)
- Organization portfolios (Enterprise tier)

**Enables ERIQ to provide:**
- Personalized interpretations tailored to user interests
- Portfolio-aware narratives
- Region-specific summaries
- Smart follow-up questions based on conversation history

### 6. Daily Digest Intelligence System

The engagement engine.

**ERIQ should access:**
- Digest summaries
- Narrative structure and section content
- Highlighted risk drivers
- Editorial commentary tags
- Digest-to-index linking (which digest sections reference which indices)

**Enables ERIQ to:**
- Expand digest analysis on demand
- Translate digest content into scenario paths
- Generate custom briefs from digest data
- Explain the editorial reasoning behind highlighted items

This dramatically improves daily login habit formation.

### 7. Methodology and Knowledge Base (RAG)

The brain of ERIQ.

**ERIQ must access:**
- GERI methodology documentation
- EERI methodology documentation
- EGSI methodology documentation
- Glossary of terms
- Interpretation playbook
- FAQ content
- Compliance rules and disclaimers

**Enables ERIQ to:**
- Teach users how the platform works
- Prevent hallucinations by grounding answers in canonical documentation
- Maintain brand authority and consistency
- Reduce support load by answering methodology questions directly

### 8. Model Confidence and Data Quality Layer

An enterprise trust booster.

**ERIQ should access:**
- Feed completeness indicators
- Model confidence scores
- Uncertainty markers
- Missing data flags
- Outlier detection outputs

**Enables ERIQ to say:**
- "Confidence is reduced today because storage data is incomplete."
- "This reading should be interpreted with caution — two of five asset feeds were unavailable."

Enterprise clients value this transparency highly.

### 9. Plan Entitlement and Monetization Engine

Revenue-critical.

**ERIQ should access:**
- Feature entitlements for the current user
- Usage quotas (questions remaining today)
- Upgrade eligibility
- Feature lock metadata (which features are gated at this plan level)

**Enables ERIQ to:**
- Tailor answer depth per plan automatically
- Trigger upgrade prompts naturally at the right moments
- Avoid accidental data leakage to lower-tier users

### 10. Product Analytics and Feedback Layer

A secret weapon most SaaS platforms ignore.

**ERIQ should access:**
- Most frequently asked questions
- Failed interpretations (low-satisfaction responses)
- User feedback tags (thumbs up/down with reasons)
- Feature usage patterns across the platform

**Enables ERIQ to:**
- Improve its own responses over time
- Guide the product roadmap based on what users actually want
- Identify gaps in documentation or methodology explanations

---

## Bonus Access Domains (Advanced — Future Value)

### 11. Scenario Simulation Engine

If implemented in a future phase, ERIQ could:
- Run "what if" simulations based on hypothetical events
- Stress-test alert escalation paths
- Forecast regime transition probabilities under different assumptions

Enterprise clients pay heavily for scenario simulation capability.

### 12. Content Generation and Reporting Layer

ERIQ could auto-create:
- Executive briefs for board-level consumption
- Trading briefs for desk distribution
- Risk committee summaries
- Weekly geopolitical outlooks

### 13. Cross-Index Interaction Models

Enables intelligence such as:
- "An EGSI spike of this magnitude increases the probability of EERI escalation within 48 hours"
- "Historical patterns suggest GERI readings above 65 precede TTF volatility expansion by 2-3 trading days"

This is a significant differentiation feature in the competitive landscape.

---

## Restricted Access (What ERIQ Must Never Access)

For security and intellectual property protection:

- Raw ingestion feeds (unprocessed RSS, API responses)
- Raw scoring algorithms and internal computation logic
- Internal weighting formulas and calibration parameters
- Other users' sensitive data (watchlists, portfolios, preferences)
- Admin debugging systems and internal diagnostics
- Pre-validation model outputs (intermediate calculations before quality checks)

---

## Final Access Architecture

```
[Application Modules]
         ↓
[Analytics & Model Output Services]
         ↓
[Context Assembly Layer (CAL)]
         ↓
[Entitlement Guardrail Layer]
         ↓
[ERIQ Analyst]
         ↓
[User]
```

---

## Integration Priority Order

Recommended sequence for connecting application layers to ERIQ:

| Priority | Domain | Impact |
|----------|--------|--------|
| 1 | Index engine outputs | Core functionality — ERIQ cannot operate without this |
| 2 | Alert intelligence | Primary driver explanation capability |
| 3 | Asset intelligence | Trading relevance and Trader plan conversion |
| 4 | Methodology knowledge base | Hallucination prevention and education |
| 5 | User personalization | Retention and enterprise stickiness |
| 6 | Historical pattern memory | Senior analyst-level depth |
| 7 | Daily digest system | Engagement and daily habit formation |
| 8 | Confidence and quality layer | Enterprise trust and transparency |
| 9 | Monetization engine | Revenue optimization and plan gating |
| 10 | Analytics feedback layer | Continuous improvement and product intelligence |

---

## Strategic Assessment

| Access Level | Result |
|-------------|--------|
| Indices + Alerts only | Good assistant |
| All 10 recommended layers | Category-defining AI risk analyst |
| All 10 + bonus domains (Scenarios, Reports, Cross-Index Models) | Enterprise-grade decision-support platform |

ERIQ evolves into: an interpretation engine, a personalized analyst, a risk education platform, a conversion engine, an enterprise knowledge assistant, and a product intelligence feedback loop.

---

*ERIQ Expert Analyst — EnergyRiskIQ Interpretation Intelligence Layer*
*Document Version: v5 | February 2026*
